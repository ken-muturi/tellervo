<html>

<head>
  <title>TRML: Tree-Ring Markup Language</title>
</head>

<body>

<h1>TRML</h1>

<p>TRML, or Tree-Ring Markup Language, is an <a
href="http://www.w3.org/XML/">XML</a>-based language for describing
tree-ring data.  It's very experimental (i.e., I wrote it in an
afternoon to see if I could), and shouldn't be used for real data yet.
It arose after some discussion on the ITRDB mailing list about adding
extra metadata fields to the already-crusty Tucson format.  My goals
with it are:

   <ul>

      <li>Extensible metadata</li>

      <li>Unicode</li>

      <li>Different types of data (earlywood/latewood/density/etc.)</li>

      <li>Easy to parse (with an XML parser, or any program that has one;
	you can easily search files with a Python or Perl script, for example)</li>

   </ul>

The downside, if there is one, is that it takes up more space on disk.
(For the file I tested it with, 42 KB for TRML versus 22 KB for
Corina.)  But disks today
are between about 10 and 160 GB, so storage space isn't really an issue.
(That would be about 250,000 medium-sized files on maybe the smallest
disks still available.  If you have more than 250,000 samples, you can
probably afford one new hard disk.)
And if it is, you can always compress the file: the same TRML file
compressed is under 5 KB (or 2 million files per 10 GB).
</p>

<h2>Sample file</h2>

<p>(The "<code>...</code>" represent more similar lines which were removed
   for readability.)</p>

<pre style="background-color: #dddddd; margin: 2em">
&lt;?xml version="1.0"?&gt;

&lt;treerings&gt;
   &lt;metadata&gt;
      &lt;start&gt;1011&lt;/start&gt;
      &lt;end&gt;1975&lt;/end&gt;
      &lt;title&gt;Blah blah blah&lt;/title&gt;
      &lt;format&gt;I&lt;/format&gt;
      &lt;author&gt;Ken Harris&lt;/author&gt;
   &lt;/metadata&gt;

   &lt;data type="width" units="0.01mm"&gt;
      &lt;v&gt;1346&lt;/v&gt; &lt;v&gt;1278&lt;/v&gt; &lt;v&gt;1536&lt;/v&gt; &lt;v&gt;1983&lt;/v&gt; &lt;v&gt;1774&lt;/v&gt;
      &lt;v&gt;1611&lt;/v&gt; &lt;v&gt;1637&lt;/v&gt; &lt;v&gt;1756&lt;/v&gt; &lt;v&gt;1310&lt;/v&gt; &lt;v&gt;864&lt;/v&gt;
      &lt;v&gt;983&lt;/v&gt; &lt;v&gt;889&lt;/v&gt; &lt;v&gt;370&lt;/v&gt; &lt;v&gt;536&lt;/v&gt; &lt;v&gt;655&lt;/v&gt;
      &lt;v&gt;774&lt;/v&gt; &lt;v&gt;562&lt;/v&gt; &lt;v&gt;1061&lt;/v&gt; &lt;v&gt;515&lt;/v&gt; &lt;v&gt;2111&lt;/v&gt;
      ...
      &lt;v&gt;1355&lt;/v&gt; &lt;v&gt;1162&lt;/v&gt; &lt;v&gt;1000&lt;/v&gt; &lt;v&gt;1038&lt;/v&gt; &lt;v&gt;971&lt;/v&gt;
      &lt;v&gt;1168&lt;/v&gt; &lt;v&gt;1002&lt;/v&gt; &lt;v&gt;1051&lt;/v&gt; &lt;v&gt;1122&lt;/v&gt; &lt;v&gt;1183&lt;/v&gt;
   &lt;/data&gt;

   &lt;data type="count" units="number"&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      ...
      &lt;v&gt;9&lt;/v&gt; &lt;v&gt;9&lt;/v&gt; &lt;v&gt;9&lt;/v&gt; &lt;v&gt;9&lt;/v&gt; &lt;v&gt;9&lt;/v&gt;
      &lt;v&gt;9&lt;/v&gt; &lt;v&gt;9&lt;/v&gt; &lt;v&gt;8&lt;/v&gt; &lt;v&gt;8&lt;/v&gt; &lt;v&gt;8&lt;/v&gt;
   &lt;/data&gt;

   &lt;data type="incr" units="number"&gt;
      &lt;v&gt;0&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt;
      &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;0&lt;/v&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      ...
      &lt;v&gt;3&lt;/v&gt; &lt;v&gt;2&lt;/v&gt; &lt;v&gt;5&lt;/v&gt; &lt;v&gt;4&lt;/v&gt; &lt;v&gt;2&lt;/v&gt;
      &lt;v&gt;8&lt;/v&gt; &lt;v&gt;2&lt;/v&gt; &lt;v&gt;4&lt;/v&gt; &lt;v&gt;6&lt;/v&gt; &lt;v&gt;7&lt;/v&gt;
   &lt;/data&gt;

   &lt;data type="decr" units="number"&gt;
      &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
      &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;0&lt;/v&gt;
      &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt; &lt;v&gt;1&lt;/v&gt; &lt;v&gt;0&lt;/v&gt;
      ...
      &lt;v&gt;6&lt;/v&gt; &lt;v&gt;7&lt;/v&gt; &lt;v&gt;4&lt;/v&gt; &lt;v&gt;5&lt;/v&gt; &lt;v&gt;7&lt;/v&gt;
      &lt;v&gt;1&lt;/v&gt; &lt;v&gt;7&lt;/v&gt; &lt;v&gt;4&lt;/v&gt; &lt;v&gt;2&lt;/v&gt; &lt;v&gt;1&lt;/v&gt;
   &lt;/data&gt;

   &lt;master range="union" value="mean"&gt;
      &lt;element&gt;chil/chil001.crn&lt;/element&gt;
      &lt;element&gt;chil/chil002.crn&lt;/element&gt;
      ...
      &lt;element&gt;chil/chil011.crn&lt;/element&gt;
      &lt;element&gt;chil/chil012.crn&lt;/element&gt;
   &lt;/master&gt;
&lt;/treerings&gt;
</pre>

<h2>Notes</h2>

<ul>

<li>The <code>&lt;metadata&gt;</code> section is required to have at least
  &lt;start&gt; and &lt;end&gt; fields; the values are real years (1 BC = -1,
  not 0).</li>

<li>There must be at least one &lt;data&gt; section, with the proper number
  of values (&lt;v&gt;) for the years it spans.</li>

<li>Of the data sections, "width" is ring width, "count" is (for a master)
the number of files that had data for that year, and "incr"/"decr" are the
number of files that were increasing/decreasing for that year.  (To keep
them the same length, the first value of incr/decr sections is always 0.)</li>

<li>For a master, the elements section lists the files that were summed to
create the master.</li>

<li>It's XML, so any Unicode characters are valid in the metadata.</li>

<li>I don't know if there's any way to require this, but if the metadata
section is first, you don't have to read the whole file to get a summary of
the metadata.</li>

<li>XML parsers are available for just about every programming language,
and easy to use, so if you ask the author of your favorite dendro program
nicely, he can probably add support to his program for this format in less
than a day.  (But don't ask yet because it's not finalized!)</li>

<li>Somebody should come up with an XML schema for this, or whatever they're using for validation these days.</li>

<li>It has been suggested that files be saved in names compatible with both CD-ROMs (ISO-something) and MS-DOS, meaning "8.3", case-insensitive.  Maintaining a separate filename is going to remain a hinderance as long as it's around.  Instead, I propose that the filename is completely redundant -- it's a storage detail that's as irrelevant as what Unicode translation format is used.  (And it has already been proposed to use XML in cases where no filename exists, like communication between a database server and a client program.)

  <ul>
  <li>On systems without such limitations (e.g., any Macintosh or Unix system, or any Windows system since 1995), a file is saved as the value of its <code>&lt;title&gt;</code>, with the extension <code>.trml</code></li>
  <li>For backwards compatibility, when storing on volumes that have filename limitations (MS-DOS disks, old CD-ROMs) the title should be truncated by the program (e.g., by using the first 3 letters of the title, plus any numbers found) to 8 characters, ensuring they are unique, and adding the extension <code>.trm</code>.</li>
  </ul>

Note that no matter which format is used, the sample (including the title) loads exactly the same way in all programs.</li>


<li>If people will be storing a lot of them on disk, perhaps a compressed format would be useful.  How about using <code>.trz</code> as an extension to mean "GZip-compressed TRML"?  (It's only 3 letters, so it works in 8.3 systems, and in a folder full of 4-letter extensions, 3 letters also suggests "smaller".)  You lose plaintext editing (temporarily), but 100 samples might take 400K instead of 4000K -- faster and easier to put on removable media.  (Note: no need to do this for network transfers, if you wrap it in a protocol that supports compression.  HTTP does, as does WebDAV, which rides on top of HTTP.)</li>

</ul>

<h2>Questions</h2>

<ul>

<li>I'd like to use a format which can be viewed/pretty-printed in any
XML-compatible web browser using only XSLT.  Unfortunately, I don't know
enough XSLT to say whether this format does that.  Help?</li>

<li>We might want to be able to store per-year comments, sort of like
you can attach comments to cells in a spreadsheet (they get a little
marker when drawn, and perhaps are printed as footnotes).  Another
data series of strings?  Attributes of the main data series?  A list
of &lt;note&gt;s?</li>

<li>We might want to be able to store additional marks, like underlining,
circling, boxing, dots over certain years, etc.  How would these be stored?</li>

<li>It should have a MIME (RFC 1341) type; how
about <code>application/x-treering-markup</code>?</li>

<li>There probably should be a way to embed images in the file.  How's
this usually done with XML?</li>

<li>There probably should be standard metadata; how about being able
to delegate part of it to a "site", like location, altitude, etc.?  Or
should filling in these fields automatically simply be the
responsibility of the user's application?  (Later...)  No, the TRML
file should store everything.  If some parts of it are the same for an
entire file (e.g., latitude, longitude, altitude), the user's
application should fill those in automatically.  The point of TRML is
being able to transfer the entire sample, with all its metadata, in
one chunk.  Note that this doesn't mean it has to be stored that way
on disk, if you're using a database, for example.</li>

</ul>

<p align="right">-- Ken Harris, &lt;<a href="mailto:kbh7@cornell.edu">kbh7@cornell.edu</a>&gt;, 18 December 2002</p>

</body>

</html>
